!function($window){"use strict";var sanitizeCallback=function(callback){return"function"==typeof callback?callback:function(){}},sanitizeInterceptor=function(interceptor){return"undefined"!=typeof interceptor?interceptor:function(model){return model}},cleanModel=function(model){var $modelStr=JSON.stringify(model);return JSON.parse($modelStr)},modelBuilder={saveRecord:function(){return function(callback){var passedCallback=sanitizeCallback(callback);this.id?this.updateRecord(passedCallback):this.createRecord(passedCallback)}},createRecord:function(modelConfig){var postBehavior=modelConfig.service.post,interceptor=sanitizeInterceptor(modelConfig.beforeCreate);return function(callback){var $this=this,passedCallback=sanitizeCallback(callback),$model=cleanModel(this),localCallback=function(id,error){null!==id?($this.id=id,passedCallback(model)):passedCallback(null,error)};$model=interceptor($model),postBehavior($model,localCallback)}},updateRecord:function(modelConfig){var putBehavior=modelConfig.service.put,interceptor=sanitizeInterceptor(modelConfig.beforeUpdate);return function(callback){var $model=cleanModel(this),passedCallback=sanitizeCallback(callback),localCallback=function(data,error){null!==data?passedCallback(model):passedCallback(null,error)};$model=interceptor($model),putBehavior($model,localCallback)}},deleteRecord:function(modelConfig){var deleteBehavior=modelConfig.service.delete,interceptor=sanitizeInterceptor(modelConfig.beforeDelete);return function(callback){var $model=cleanModel(this),passedCallback=sanitizeCallback(callback),localCallback=function(data,error){null!==data?passedCallback(model):passedCallback(null,error)};$model=interceptor($model),deleteBehavior($model,localCallback)}},revise:function(){return function(updateObj){for(var key in this)this.hasOwnProperty(key)&&"function"!=typeof this[key]&&(this[key]="undefined"!=typeof updateObj[key]?updateObj[key]:this[key])}},copy:function(){return function(){return cleanModel(this)}}},Modella=function(){};Modella.prototype={modelConfig:{},createInstance:function(config){var sanitizedConfig="undefined"!=typeof config?config:{},$modellaObject=Object.create(this);return $modellaObject.modelConfig=sanitizedConfig,$modellaObject},init:function(callback){var passedCallback=(this.modelConfig,sanitizeCallback(callback)),localCallback=function(dataObject,error){passedCallback(dataObject,error)};"undefined"!=typeof this.modelConfig.initialObject?this.initByObject(this.modelConfig.initialObject,localCallback):"undefined"!=typeof this.modelConfig.initialId?this.initById(this.modelConfig.initialId,localCallback):"undefined"!=typeof this.modelConfig.initialParentId?this.initByParentId(this.modelConfig.initialParentId,localCallback):"undefined"!=typeof this.modelConfig.initialIds?this.initByIds(this.modelConfig.initialIds,localCallback):passedCallback(null,Error("Unable to initialize model."))},initByObject:function(modelObject,callback){var passedCallback=sanitizeCallback(callback),localCallback=function(model){passedCallback(model)};this.initModel(modelObject,localCallback)},initById:function(id,callback){var $this=this,passedCallback=sanitizeCallback(callback),localCallback=function(dataObject,error){null!==dataObject?$this.initByObject(dataObject,passedCallback):passedCallback(null,error)};this.modelConfig.service.get(id,localCallback)},initByIds:function(idSet,callback){for(var $this=this,index=-1,finalModelSet=[],passedCallback=sanitizeCallback(callback),pushModel=function(model){finalModelSet.push(model)},localCallback=function(model,error){null!==model?$this.initByObject(model,pushModel):null!==finalModelSet&&(finalModelSet=null,passedCallback(null,error)),null!==finalModelSet&&finalModelSet.length===idSet.length&&passedCallback(finalModelSet)};"undefined"!=typeof idSet[++index];)this.modelConfig.service.get(idSet[index],localCallback)},initByParentId:function(parentId,callback){var $this=this,finalModelSet=[],passedCallback=sanitizeCallback(callback),pushModel=function(model){finalModelSet.push(model)},prepareModelSet=function(dataSet){for(var index=-1;"undefined"!=typeof dataSet[++index];)$this.initByObject(dataSet[index],pushModel)},localCallback=function(modelSet,error){null!==modelSet?(prepareModelSet(modelSet),passedCallback(finalModelSet)):passedCallback(null,error)};this.modelConfig.service.getByParentId(parentId,localCallback)},initModel:function(modelObject,callback){var passedCallback=sanitizeCallback(callback);for(var key in modelBuilder)modelBuilder.hasOwnProperty(key)&&(modelObject[key]=modelBuilder[key](this.modelConfig));passedCallback(modelObject)}},$window.modella=Modella,$window.modella.utilities={sanitizeCallback:sanitizeCallback,sanitizeInterceptor:sanitizeInterceptor,cleanModel:cleanModel}}(window);